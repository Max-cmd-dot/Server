{"version":3,"sources":["../../src/routes/apidata.js"],"names":["router","require","Router","Data","validate","get","req","res","error","body","groupId","query","status","send","message","details","data","find","topic","group","sort","_id","limit","json","console","log","$or","module","exports"],"mappings":"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","file":"apidata.js","sourcesContent":["const router = require(\"express\").Router();\r\nconst { Data, validate } = require(\"../models/apidata\");\r\n\r\nrouter.get(\"/latestdata/Temperature\", async (req, res) => {\r\n  try {\r\n    const { error } = validate(req.body);\r\n    const groupId = req.query.groupId;\r\n    if (error)\r\n      return res.status(400).send({ message: error.details[0].message });\r\n\r\n    const data = await Data.find({\r\n      topic: \"esp/air/temperature\",\r\n      group: groupId,\r\n    })\r\n      .sort({ _id: -1 })\r\n      .limit(1);\r\n    if (data) return res.json(data);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nrouter.get(\"/latestdata/Humidity\", async (req, res) => {\r\n  try {\r\n    const { error } = validate(req.body);\r\n    const groupId = req.query.groupId;\r\n    if (error)\r\n      return res.status(400).send({ message: error.details[0].message });\r\n\r\n    const data = await Data.find({\r\n      topic: \"esp/air/humidity\",\r\n      group: groupId,\r\n    })\r\n      .sort({ _id: -1 })\r\n      .limit(1);\r\n    if (data) return res.json(data);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nrouter.get(\"/latestdata/Moisture/1\", async (req, res) => {\r\n  try {\r\n    const { error } = validate(req.body);\r\n    const groupId = req.query.groupId;\r\n    if (error)\r\n      return res.status(400).send({ message: error.details[0].message });\r\n\r\n    const data = await Data.find({\r\n      topic: \"esp/ground/moisture/1\",\r\n      group: groupId,\r\n    })\r\n      .sort({ _id: -1 })\r\n      .limit(1);\r\n    if (data) return res.json(data);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nrouter.get(\"/latestdata/Lux\", async (req, res) => {\r\n  try {\r\n    const { error } = validate(req.body);\r\n    const groupId = req.query.groupId;\r\n    if (error)\r\n      return res.status(400).send({ message: error.details[0].message });\r\n\r\n    const data = await Data.find({\r\n      topic: \"esp/ground/light/lux\",\r\n      group: groupId,\r\n    })\r\n      .sort({ _id: -1 })\r\n      .limit(1);\r\n    if (data) return res.json(data);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nrouter.get(\"/latestdata/All\", async (req, res) => {\r\n  try {\r\n    const { error } = validate(req.body);\r\n    const groupId = req.query.groupId;\r\n    if (error)\r\n      return res.status(400).send({ message: error.details[0].message });\r\n\r\n    const data = await Data.find({\r\n      $or: [\r\n        { topic: \"esp/ground/moisture/1\" },\r\n        { topic: \"esp/air/temperature\" },\r\n        { topic: \"esp/air/humidity\" },\r\n        { topic: \"esp/ground/light/lux\" },\r\n        { topic: \"esp/ground/light/red\" },\r\n        { topic: \"esp/ground/light/green\" },\r\n        { topic: \"esp/ground/light/blue\" },\r\n        { topic: \"esp/ground/light/clear\" },\r\n        { topic: \"esp/air/pressure\" },\r\n        { topic: \"esp/ground/moisture/2\" },\r\n        { topic: \"esp/ground/moisture/3\" },\r\n      ],\r\n      group: groupId,\r\n    })\r\n      .sort({ _id: -1 })\r\n      .limit(11);\r\n    if (data) return res.json(data);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nrouter.get(\"/All/temperature\", async (req, res) => {\r\n  try {\r\n    const { error } = validate(req.body);\r\n    const groupId = req.query.groupId;\r\n    if (error)\r\n      return res.status(400).send({ message: error.details[0].message });\r\n\r\n    const data = await Data.find({\r\n      topic: \"esp/air/temperature\",\r\n      group: groupId,\r\n    })\r\n      .sort({ _id: -1 })\r\n      .limit(1000);\r\n    if (data) return res.json(data);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nrouter.get(\"/All/humidity\", async (req, res) => {\r\n  try {\r\n    const { error } = validate(req.body);\r\n    const groupId = req.query.groupId;\r\n    if (error)\r\n      return res.status(400).send({ message: error.details[0].message });\r\n\r\n    const data = await Data.find({\r\n      topic: \"esp/air/humidity\",\r\n      group: groupId,\r\n    })\r\n      .sort({ _id: -1 })\r\n      .limit(1000);\r\n    if (data) return res.json(data);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nrouter.get(\"/All/Lux\", async (req, res) => {\r\n  try {\r\n    const { error } = validate(req.body);\r\n    const groupId = req.query.groupId;\r\n    if (error)\r\n      return res.status(400).send({ message: error.details[0].message });\r\n\r\n    const data = await Data.find({\r\n      topic: \"esp/ground/light/lux\",\r\n      group: groupId,\r\n    })\r\n      .sort({ _id: -1 })\r\n      .limit(1000);\r\n    if (data) return res.json(data);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nrouter.get(\"/All/moisture/1\", async (req, res) => {\r\n  try {\r\n    const { error } = validate(req.body);\r\n    const groupId = req.query.groupId;\r\n    if (error)\r\n      return res.status(400).send({ message: error.details[0].message });\r\n\r\n    const data = await Data.find({\r\n      topic: \"esp/ground/moisture/1\",\r\n      group: groupId,\r\n    })\r\n      .sort({ _id: -1 })\r\n      .limit(1000);\r\n    if (data) return res.json(data);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nrouter.get(\"/All/moisture/2\", async (req, res) => {\r\n  try {\r\n    const { error } = validate(req.body);\r\n    const groupId = req.query.groupId;\r\n    if (error)\r\n      return res.status(400).send({ message: error.details[0].message });\r\n\r\n    const data = await Data.find({\r\n      topic: \"esp/ground/moisture/2\",\r\n      group: groupId,\r\n    })\r\n      .sort({ _id: -1 })\r\n      .limit(1000);\r\n    if (data) return res.json(data);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nrouter.get(\"/All/moisture/3\", async (req, res) => {\r\n  try {\r\n    const { error } = validate(req.body);\r\n    const groupId = req.query.groupId;\r\n    if (error)\r\n      return res.status(400).send({ message: error.details[0].message });\r\n\r\n    const data = await Data.find({\r\n      topic: \"esp/ground/moisture/3\",\r\n      group: groupId,\r\n    })\r\n      .sort({ _id: -1 })\r\n      .limit(1000);\r\n    if (data) return res.json(data);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"]}